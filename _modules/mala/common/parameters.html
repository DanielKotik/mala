

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>mala.common.parameters &mdash; MALA  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/mala_favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> MALA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features/neuralnetworks.html">Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features/postprocessing.html">Postprocessing</a></li>
</ul>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/README.html">Installation of MALA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/INSTALL_LAMMPS.html">Setting up LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/INSTALL_TE_QE.html">Python bindings to Quantum Espresso</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/tested_systems.html">Successfully tested on</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">mala</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MALA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>mala.common.parameters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mala.common.parameters</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Collection of all parameter related classes and functions.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">.printout</span> <span class="kn">import</span> <span class="n">printout</span><span class="p">,</span> <span class="n">set_horovod_status</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">horovod.torch</span> <span class="k">as</span> <span class="nn">hvd</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You either don&#39;t have Horovod installed or it is not &quot;</span>
                  <span class="s2">&quot;configured correctly. You can still train networks, but &quot;</span>
                  <span class="s2">&quot;attempting to set parameters.training.use_horovod = &quot;</span>
                  <span class="s2">&quot;True WILL cause a crash.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">torch</span>


<div class="viewcode-block" id="ParametersBase"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersBase">[docs]</a><span class="k">class</span> <span class="nc">ParametersBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base parameter class for MALA.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParameterBase.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="ParametersBase.show"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersBase.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print name and values of all attributes of this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : string</span>
<span class="sd">            The indent used in the list with which the parameter</span>
<span class="sd">            shows itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span></div></div>


<div class="viewcode-block" id="ParametersNetwork"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersNetwork">[docs]</a><span class="k">class</span> <span class="nc">ParametersNetwork</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for constructing a neural network.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nn_type : string</span>
<span class="sd">        Type of the neural network that will be used. Currently supported is</span>
<span class="sd">        only feed-forward, which is also the default</span>

<span class="sd">    layer_sizes : list</span>
<span class="sd">        A list of integers detailing the sizes of the layer of the neural</span>
<span class="sd">        network. Please note that the input layer is included therein.</span>
<span class="sd">        Default: [10,10,0]</span>

<span class="sd">    layer_activations: list</span>
<span class="sd">        A list of strings detailing the activation functions to be used</span>
<span class="sd">        by the neural network. If the dimension of layer_activations is</span>
<span class="sd">        smaller than the dimension of layer_sizes-1, than the first entry</span>
<span class="sd">        is used for all layers.</span>
<span class="sd">        Currently supported activation functions are:</span>

<span class="sd">            - Sigmoid (default)</span>
<span class="sd">            - ReLU</span>
<span class="sd">            - LeakyReLU</span>

<span class="sd">    loss_function_type: string</span>
<span class="sd">        Loss function for the neural network</span>
<span class="sd">        Currently supported loss functions include:</span>

<span class="sd">            - mse (Mean squared error; default)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersNetwork.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn_type</span> <span class="o">=</span> <span class="s2">&quot;feed-forward&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_activations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sigmoid&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_function_type</span> <span class="o">=</span> <span class="s2">&quot;mse&quot;</span></div>


<div class="viewcode-block" id="ParametersDescriptors"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersDescriptors">[docs]</a><span class="k">class</span> <span class="nc">ParametersDescriptors</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for calculating/parsing input descriptors.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    descriptor_type : string</span>
<span class="sd">        Type of descriptors that is used to represent the atomic fingerprint.</span>
<span class="sd">        Currently only &quot;SNAP&quot; is supported.</span>

<span class="sd">    twojmax : int</span>
<span class="sd">        SNAP calculation: 2*jmax-parameter used for calculation of SNAP</span>
<span class="sd">        descriptors. Default value for jmax is 5, so default value for</span>
<span class="sd">        twojmax is 10.</span>

<span class="sd">    rcutfac: float</span>
<span class="sd">        SNAP calculation: radius cutoff factor for the fingerprint sphere in</span>
<span class="sd">        Angstroms. Default value is 4.67637.</span>

<span class="sd">    lammps_compute_file: string</span>
<span class="sd">        SNAP calculation: LAMMPS input file that is used to calculate the</span>
<span class="sd">        SNAP descriptors. If this string is empty, the standard LAMMPS input</span>
<span class="sd">        file found in this repository will be used (recommended).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersDescriptors.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersDescriptors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_type</span> <span class="o">=</span> <span class="s2">&quot;SNAP&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twojmax</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rcutfac</span> <span class="o">=</span> <span class="mf">4.67637</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lammps_compute_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="ParametersTargets"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersTargets">[docs]</a><span class="k">class</span> <span class="nc">ParametersTargets</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for calculating/parsing output quantites.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    target_type : string</span>
<span class="sd">        Number of points in the energy grid that is used to calculate the</span>
<span class="sd">        (L)DOS.</span>

<span class="sd">    ldos_gridsize : float</span>
<span class="sd">        Gridspacing of the energy grid the (L)DOS is evaluated on [eV].</span>

<span class="sd">    ldos_gridspacing_ev: float</span>
<span class="sd">        SNAP calculation: radius cutoff factor for the fingerprint sphere in</span>
<span class="sd">        Angstroms. Default value is 4.67637.</span>

<span class="sd">    ldos_gridoffset_ev: float</span>
<span class="sd">        Lowest energy value on the (L)DOS energy grid [eV].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParameterTargets.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersTargets</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;LDOS&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridsize</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridspacing_ev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridoffset_ev</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="ParametersData"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersData">[docs]</a><span class="k">class</span> <span class="nc">ParametersData</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for loading and preprocessing data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    descriptors_contain_xyz : bool</span>
<span class="sd">        Legacy option. If True, it is assumed that the first three entries of</span>
<span class="sd">        the descriptor vector are the xyz coordinates and they are cut from the</span>
<span class="sd">        descriptor vector. If False, no such cutting is peformed.</span>

<span class="sd">    snapshot_directories_list : list</span>
<span class="sd">        A list of all added snapshots.</span>

<span class="sd">    data_splitting_type : string</span>
<span class="sd">        Specify how the data for validation, test and training is splitted.</span>
<span class="sd">        Currently the only supported option is by_snapshot,</span>
<span class="sd">        which splits the data by snapshot boundaries. It is also the default.</span>

<span class="sd">    data_splitting_snapshots : list</span>
<span class="sd">        Details how (and which!) snapshots are used for what:</span>

<span class="sd">          - te: This snapshot will be a testing snapshot.</span>
<span class="sd">          - tr: This snapshot will be a training snapshot.</span>
<span class="sd">          - va: This snapshot will be a validation snapshot.</span>

<span class="sd">        Please note that the length of this list and the number of snapshots</span>
<span class="sd">        must be identical. The first element of this list will be used</span>
<span class="sd">        to characterize the first snapshot, the second element for the second</span>
<span class="sd">        snapshot etc.</span>

<span class="sd">    input_rescaling_type : string</span>
<span class="sd">        Specifies how input quantities are normalized.</span>
<span class="sd">        Options:</span>

<span class="sd">            - &quot;None&quot;: No normalization is applied.</span>
<span class="sd">            - &quot;standard&quot;: Standardization (Scale to mean 0, standard</span>
<span class="sd">              deviation 1)</span>
<span class="sd">            - &quot;normal&quot;: Min-Max scaling (Scale to be in range 0...1)</span>
<span class="sd">            - &quot;feature-wise-standard&quot;: Row Standardization (Scale to mean 0,</span>
<span class="sd">              standard deviation 1)</span>
<span class="sd">            - &quot;feature-wise-normal&quot;: Row Min-Max scaling (Scale to be in range</span>
<span class="sd">              0...1)</span>

<span class="sd">    output_rescaling_type : string</span>
<span class="sd">        Specifies how output quantities are normalized.</span>
<span class="sd">        Options:</span>

<span class="sd">            - &quot;None&quot;: No normalization is applied.</span>
<span class="sd">            - &quot;standard&quot;: Standardization (Scale to mean 0,</span>
<span class="sd">                standard deviation 1)</span>
<span class="sd">            - &quot;normal&quot;: Min-Max scaling (Scale to be in range 0...1)</span>
<span class="sd">            - &quot;feature-wise-standard&quot;: Row Standardization (Scale to mean 0,</span>
<span class="sd">                standard deviation 1)</span>
<span class="sd">            - &quot;feature-wise-normal&quot;: Row Min-Max scaling (Scale to be in</span>
<span class="sd">                range 0...1)</span>

<span class="sd">    use_lazy_loading : bool</span>
<span class="sd">        If True, data is lazily loaded, i.e. only the snapshots that are</span>
<span class="sd">        currently needed will be kept in memory. This greatly reduces memory</span>
<span class="sd">        demands, but adds additional computational time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersData.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors_contain_xyz</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_directories_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_splitting_type</span> <span class="o">=</span> <span class="s2">&quot;by_snapshot&quot;</span>
        <span class="c1"># self.data_splitting_percent = [0,0,0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_splitting_snapshots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_rescaling_type</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_rescaling_type</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_lazy_loading</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ParametersRunning"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersRunning">[docs]</a><span class="k">class</span> <span class="nc">ParametersRunning</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters needed for network runs (train, test or inference).</span>

<span class="sd">    Some of these parameters only apply to either the train or test or</span>
<span class="sd">    inference case.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    trainingtype : string</span>
<span class="sd">        Training type to be used. Supported options at the moment:</span>

<span class="sd">            - SGD: Stochastic gradient descent.</span>
<span class="sd">            - Adam: Adam Optimization Algorithm</span>

<span class="sd">    learning_rate : float</span>
<span class="sd">        Learning rate for chosen optimization algorithm. Default: 0.5.</span>

<span class="sd">    max_number_epochs : int</span>
<span class="sd">        Maximum number of epochs to train for. Default: 100.</span>

<span class="sd">    verbosity : bool</span>
<span class="sd">        If True, training output is shown during training. Default: True.</span>

<span class="sd">    mini_batch_size : int</span>
<span class="sd">        Size of the mini batch for the optimization algorihm. Default: 10.</span>

<span class="sd">    weight_decay : float</span>
<span class="sd">        Weight decay for regularization. Always refers to L2 regularization.</span>
<span class="sd">        Default: 0.</span>

<span class="sd">    early_stopping_epochs : int</span>
<span class="sd">        Number of epochs the validation accuracy is allowed to not improve by</span>
<span class="sd">        at leastearly_stopping_threshold, before we terminate. If 0, no</span>
<span class="sd">        early stopping is performed. Default: 0.</span>

<span class="sd">    early_stopping_threshold : float</span>
<span class="sd">        If the validation accuracy does not improve by at least threshold for</span>
<span class="sd">        early_stopping_epochs epochs, training is terminated:</span>
<span class="sd">        validation_loss &lt; validation_loss_old * (1+early_stopping_threshold),</span>
<span class="sd">        or patience counter will go up.</span>
<span class="sd">        Default: 0. Numbers bigger than 0 can make early stopping very</span>
<span class="sd">        aggresive.</span>

<span class="sd">    learning_rate_scheduler : string</span>
<span class="sd">        Learning rate scheduler to be used. If not None, an instance of the</span>
<span class="sd">        corresponding pytorch class will be used to manage the learning rate</span>
<span class="sd">        schedule.</span>
<span class="sd">        Options:</span>

<span class="sd">            - None: No learning rate schedule will be used.</span>
<span class="sd">            - &quot;ReduceLROnPlateau&quot;: The learning rate will be reduced when the</span>
<span class="sd">              validation loss is plateauing.</span>

<span class="sd">    learning_rate_decay : float</span>
<span class="sd">        Decay rate to be used in the learning rate (if the chosen scheduler</span>
<span class="sd">        supports that).</span>
<span class="sd">        Default: 0.1</span>

<span class="sd">    learning_rate_patience : int</span>
<span class="sd">        Patience parameter used in the learning rate schedule (how long the</span>
<span class="sd">        validation loss has to plateau before the schedule takes effect).</span>
<span class="sd">        Default: 0.</span>

<span class="sd">    use_compression : bool</span>
<span class="sd">        If True and horovod is used, horovod compression will be used for</span>
<span class="sd">        allreduce communication. This can improve performance.</span>

<span class="sd">    kwargs : dict</span>
<span class="sd">        Dictionary for keyword arguments for horovod.</span>

<span class="sd">    sampler : dict</span>
<span class="sd">        Dictionary with samplers.</span>

<span class="sd">    use_shuffling_for_samplers :</span>
<span class="sd">        If True, the training data will be shuffled in between epochs.</span>
<span class="sd">        If lazy loading is selected, then this shuffling will be done on</span>
<span class="sd">        a &quot;by snapshot&quot; basis.</span>

<span class="sd">    checkpoints_each_epoch : int</span>
<span class="sd">        If not 0, checkpoint files will be saved after eac</span>
<span class="sd">        checkpoints_each_epoch epoch.</span>

<span class="sd">    checkpoint_name : string</span>
<span class="sd">        Name used for the checkpoints. Using this, multiple runs</span>
<span class="sd">        can be performed in the same directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersRunning.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersRunning</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingtype</span> <span class="o">=</span> <span class="s2">&quot;SGD&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_number_epochs</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="c1"># TODO: Find a better system for verbosity. Maybe a number.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mini_batch_size</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_decay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping_epochs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping_threshold</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_scheduler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_decay</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_patience</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_compression</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># TODO: Give this parameter a more descriptive name.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_workers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pin_memory&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="c1"># TODO: Objects should not be parameters!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train_sampler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;validate_sampler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;test_sampler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_shuffling_for_samplers</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_each_epoch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_name</span> <span class="o">=</span> <span class="s2">&quot;checkpoint_mala&quot;</span></div>


<div class="viewcode-block" id="ParametersHyperparameterOptimization"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersHyperparameterOptimization">[docs]</a><span class="k">class</span> <span class="nc">ParametersHyperparameterOptimization</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperparameter optimization parameters.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    direction : string</span>
<span class="sd">        Controls whether to minimize or maximize the loss function.</span>
<span class="sd">        Arguments are &quot;minimize&quot; and &quot;maximize&quot; respectively.</span>

<span class="sd">    n_trials : int</span>
<span class="sd">        Controls how many trials are performed (when using optuna).</span>
<span class="sd">        Default: 100.</span>

<span class="sd">    hlist : list</span>
<span class="sd">        List containing hyperparameters, that are then passed to optuna.</span>
<span class="sd">        Supported options so far include:</span>

<span class="sd">            - learning_rate (float): learning rate of the training algorithm</span>
<span class="sd">            - layer_activation_xxx (categorical): Activation function used for</span>
<span class="sd">              the feed forward network (see Netwok  parameters for supported</span>
<span class="sd">              activation functions). Note that _xxx is only so that optuna</span>
<span class="sd">              will differentiate between variables. No reordering is</span>
<span class="sd">              performed by the; the order depends on the order in the</span>
<span class="sd">              list. _xxx can be essentially anything. Please note further</span>
<span class="sd">              that you need to either only request one acitvation function</span>
<span class="sd">              (for all layers) or one for specifically for each layer.</span>
<span class="sd">            - ff_neurons_layer_xxx(int): Number of neurons per a layer. Note</span>
<span class="sd">              that _xxx is only so that optuna will differentiate between</span>
<span class="sd">              variables. No reordering is performed by MALA; the order</span>
<span class="sd">              depends on the order in the list. _xxx can be essentially</span>
<span class="sd">              anything.</span>

<span class="sd">        Users normally don&#39;t have to fill this list by hand, the hyperparamer</span>
<span class="sd">        optimizer provide interfaces for this task.</span>


<span class="sd">    hyper_opt_method : string</span>
<span class="sd">        Method used for hyperparameter optimization. Currently supported:</span>

<span class="sd">            - &quot;optuna&quot; : Use optuna for the hyperparameter optimization.</span>
<span class="sd">            - &quot;oat&quot; : Use orthogonal array tuning (currently limited to</span>
<span class="sd">              categorical hyperparemeters). Range analysis is</span>
<span class="sd">              currently done by simply choosing the lowesr loss.</span>
<span class="sd">            - &quot;notraining&quot; : Using a NAS without training, based on jacobians.</span>

<span class="sd">    checkpoints_each_trial : int</span>
<span class="sd">        If not 0, checkpoint files will be saved after each</span>
<span class="sd">        checkpoints_each_trial trials. Currently, this only works with</span>
<span class="sd">        optuna.</span>

<span class="sd">    checkpoint_name : string</span>
<span class="sd">        Name used for the checkpoints. Using this, multiple runs</span>
<span class="sd">        can be performed in the same directory. Currently. this</span>
<span class="sd">        only works with optuna.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersHyperparameterOptimization.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersHyperparameterOptimization</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyper_opt_method</span> <span class="o">=</span> <span class="s2">&quot;optuna&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_each_trial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_name</span> <span class="o">=</span> <span class="s2">&quot;checkpoint_mala_ho&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdb_storage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdb_storage_heartbeat</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rdb_storage_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Control whether a heartbeat is used for distributed optuna runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span>

    <span class="nd">@rdb_storage_heartbeat</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rdb_storage_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ParametersHyperparameterOptimization.show"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersHyperparameterOptimization.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print name and values of all attributes of this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : string</span>
<span class="sd">            The indent used in the list with which the parameter</span>
<span class="sd">            shows itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;hlist&quot;</span><span class="p">:</span>
                <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;hlist&quot;</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlist</span><span class="p">:</span>
                    <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="s2">&quot;hyperparameter #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">hyp</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="ParametersDebug"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.ParametersDebug">[docs]</a><span class="k">class</span> <span class="nc">ParametersDebug</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All debugging parameters.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    grid_dimensions : list</span>
<span class="sd">        A list containing three elements. It enforces a smaller grid size</span>
<span class="sd">        globally when it is not empty.. Default : []</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of ParametersDebug.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersDebug</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_dimensions</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All parameter MALA needs to perform its various tasks.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    comment : string</span>
<span class="sd">        Characterizes a set of parameters (e.g. &quot;experiment_ddmmyy&quot;).</span>

<span class="sd">    network : ParametersNetwork</span>
<span class="sd">        Contains all parameters necessary for constructing a neural network.</span>

<span class="sd">    descriptors : ParametersDescriptors</span>
<span class="sd">        Contains all parameters necessary for calculating/parsing descriptors.</span>

<span class="sd">    targets : ParametersTargets</span>
<span class="sd">        Contains all parameters necessary for calculating/parsing output</span>
<span class="sd">        quantites.</span>

<span class="sd">    data : ParametersData</span>
<span class="sd">        Contains all parameters necessary for loading and preprocessing data.</span>

<span class="sd">    running : ParametersRunning</span>
<span class="sd">        Contains parameters needed for network runs (train, test or inference).</span>

<span class="sd">    hyperparameters : ParametersHyperparameterOptimization</span>
<span class="sd">        Parameters used for hyperparameter optimization.</span>

<span class="sd">    debug : ParametersDebug</span>
<span class="sd">        Container for all debugging parameters.</span>

<span class="sd">    manual_seed: int</span>
<span class="sd">        If not none, this value is used as manual seed for the neural networks.</span>
<span class="sd">        Can be used to make experiments comparable. Default: None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an instance of Parameters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">ParametersNetwork</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="n">ParametersDescriptors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">ParametersTargets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ParametersData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="n">ParametersRunning</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">ParametersHyperparameterOptimization</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">ParametersDebug</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_seed</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Control whether or not a GPU is used (provided there is one).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span>

    <span class="nd">@use_gpu</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GPU requested, but no GPU found. MALA will &quot;</span>
                              <span class="s2">&quot;operate with CPU only.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Control whether or not horovod is used for parallel training.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_horovod</span>

    <span class="nd">@use_horovod</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">hvd</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">set_horovod_status</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_horovod</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Parameters.show"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.Parameters.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print name and values of all attributes of this object.&quot;&quot;&quot;</span>
        <span class="n">printout</span><span class="p">(</span><span class="s2">&quot;--- &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ---&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">ParametersBase</span><span class="p">):</span>
                <span class="n">parobject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">printout</span><span class="p">(</span><span class="s2">&quot;--- &quot;</span> <span class="o">+</span> <span class="n">parobject</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ---&quot;</span><span class="p">)</span>
                <span class="n">parobject</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">printout</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Parameters.save"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.Parameters.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;pickle&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Parameters object to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        save_format : string</span>
<span class="sd">            File format which is used for parameter saving.</span>
<span class="sd">            Currently only supported file format is &quot;pickle&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hvd</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported parameter save format.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.load_from_file"><a class="viewcode-back" href="../../../api/mala.common.html#mala.common.parameters.Parameters.load_from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
                       <span class="n">no_snapshots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Parameters object from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        save_format : string</span>
<span class="sd">            File format which is used for parameter saving.</span>
<span class="sd">            Currently only supported file format is &quot;pickle&quot;.</span>

<span class="sd">        no_snapshots : bool</span>
<span class="sd">            If True, than the snapshot list will be emptied. Useful when</span>
<span class="sd">            performing inference/testing after training a network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loaded_parameters : Parameters</span>
<span class="sd">            The loaded Parameters object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">loaded_parameters</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">no_snapshots</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">loaded_parameters</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">snapshot_directories_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported parameter save format.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loaded_parameters</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, HZDR.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>